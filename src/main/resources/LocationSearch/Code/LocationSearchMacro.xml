<?xml version="1.1" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.5" reference="LocationSearch.Code.LocationSearchMacro" locale="">
  <web>LocationSearch.Code</web>
  <name>LocationSearchMacro</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <originalMetadataAuthor>xwiki:XWiki.Admin</originalMetadataAuthor>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>Location Search Macro</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content/>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>f005c0e8-b2a1-4a5a-b680-099202f98542</guid>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <defaultValue>long</defaultValue>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <restricted>0</restricted>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>window.addEventListener("DOMContentLoaded", function () {
  const locationSearchMacroDoc = new XWiki.Document(
    XWiki.Model.resolve("LocationSearch.Code.LocationSearchService", XWiki.EntityType.DOCUMENT)
  );

  function getKindIcon(kind) {
    if (kind.startsWith("attachment")) {
      return fa("paperclip");
    }

    if (kind === "comment") {
      return fa("comment-o");
    }

    if (kind === "object") {
      return fa("cubes");
    }

    return fa("file-o");
  }

  function fa(icon) {
    return "fa fa-" + icon;
  }

  function getSpanIcon(faIcon) {
    const span = document.createElement("span");
    span.className = faIcon;
    return span;
  }

  async function load(typedText, callback, input) {
    if (typedText.length &lt; 3) {
      callback([]);
      return;
    }

    const locationSearch = input.closest(".searchLocation-quickSearch");

    const params = new URLSearchParams({
      q: input.value,
      nb: "10",
      outputSyntax: "plain",
      excerpts: (locationSearch.dataset.excerpts === "true") ? 1 : 0,
      wiki: locationSearch.dataset.wiki,
      className: locationSearch.querySelector('input[name="f_class"]')?.value || "",
      tags: [].map.call(locationSearch.querySelectorAll('input[name="f_property.XWiki.TagClass.tags_string"]'), input =&gt; input.value).join(","),
      kind: locationSearch.dataset.searchKind
    });

    for (const spaceFacet of locationSearch.querySelectorAll('input[name="f_space_facet"]')) {
      params.append("spaceFacet", spaceFacet.value);
    }

    const response = await fetch(locationSearchMacroDoc.getURL("get", params.toString()));

    if (response.ok) {
      callback(await response.json());
    }
  }

  const solrSpecialChars = ["\\", "+", "-", "&amp;&amp;", "||", "!", "(", ")", "{", "}", "[",
      "]", "^", "\"", "~", "*", "?", ":", "/", " "];
  const escapedSolrSpecialChars = ["\\\\", "\\+", "\\-", "\\&amp;&amp;", "\\||", "\\!", "\\(",
        "\\)", "\\{", "\\}", "\\[", "\\]", "\\^", "\\\"", "\\~", "\\*", "\\?", "\\:", "\\/", "\\ "]

  function escapeSolr(v) {
    for (const [toReplace, replacement] of solrSpecialChars.map((k, i) =&gt; [k, escapedSolrSpecialChars[i]])) {
      v = v.replaceAll(toReplace, replacement);
    }
    return v;
  }

  for (const searchLocation of document.querySelectorAll('.searchLocation-quickSearch')) {
    if (searchLocation.dataset.suggest === "true") {
      prepareSuggestions(searchLocation, load);
    }

    searchLocation.querySelector("form").addEventListener("formdata", function (e) {
      const formData = e.formData;
      const v = escapeSolr(formData.get("text"));
      switch (searchLocation.dataset.searchKind) {
        case "attachmentName":
          formData.set("text", "filename:" + v);
          break;
        case "attachment":
          formData.set("text", "filename:" + v + " attcontent: " + v);
          break;
        case "attachmentContent":
          formData.set("text", "attcontent:" + v);
          break;
        case "object":
          formData.set("text", "objcontent:" + v);
          break;
        case "title":
          formData.set("text", "title:" + v);
          break;
        case "comment":
          formData.set("text", "property.XWiki.XWikiComments.comment:" + v);
          break;
        default:
          formData.set("text", v);
      }
    });
  }

  var suggestions = null;
  var currentInput = null;
  function fixPosition() {
    if (suggestions &amp;&amp; currentInput) {
      const rect = currentInput.getBoundingClientRect();
      suggestions.style.top = rect.bottom + "px";
      suggestions.style.left = rect.left + "px";
      suggestions.style.minWidth = rect.width + "px";
      suggestions.style.maxHeight = (window.innerHeight - rect.bottom) + "px";
      suggestions.style.maxWidth = (window.innerWidth - rect.left) + "px";
    }
  }

  function hideSuggestions() {
    if (suggestions) {
      suggestions.hidden = true;
    }
  }

  function suggestionkeyDown(e) {
    if (!suggestions || (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey)) {
      return;
    }

    if (e.keyCode === 27 || e.key === "Escape") {
      hideSuggestions();
      currentInput.focus();
      return;
    }

    if (e.keyCode === 40 || e.key === 'ArrowDown') {
      if (e.target.nodeName.toLowerCase() === "a") {
        const currentLi = e.target.closest("li");
        const nextLi = currentLi?.nextSibling;
        if (nextLi) {
          nextLi.querySelector("a")?.focus();
          e.preventDefault();
        }
      } else {
        suggestions.querySelector("a")?.focus();
        e.preventDefault();
      }
    } else if (e.keyCode === 38 || e.key === 'ArrowUp' &amp;&amp; e.target.nodeName.toLowerCase() === "a") {
      const currentLi = e.target.closest("li");
      const previousLi = currentLi?.previousSibling;
      if (previousLi) {
        previousLi.querySelector("a")?.focus();
        e.preventDefault();
      } else {
        currentInput.focus();
        e.preventDefault();
      }
    }
  }

  function suggestionsFocusIn() {
    const nodeName = document.activeElement.nodeName.toLowerCase();
    if (
      (nodeName !== "a" &amp;&amp; nodeName !== "input") ||
      !document.activeElement.closest(".searchLocation-quickSearch,.searchLocation-quickSearch-suggestions")
    ) {
      hideSuggestions();
    }
  }

  function prepareSuggestions(locationSearch, load) {
    const input = locationSearch.querySelector('input[type="text"]');
    let debounceTimeout = -1;
    function debouncedTriggerSuggestions(e) {
      if (debounceTimeout !== -1) {
        clearTimeout(debounceTimeout);
      }

      if (input.value.length &lt; 3 || e.keyCode === 27 || e.key === "Escape") {
        hideSuggestions();
        return;
      }

      debounceTimeout = setTimeout(() =&gt; {
        debounceTimeout = -1;
        triggerSuggestions(e)
      }, 250);
    }

    let currentSuggestionRequest = "";
    let requestId = 0;
    input.autocomplete = "off";
    input.addEventListener("keyup", debouncedTriggerSuggestions);
    input.addEventListener("click", triggerSuggestions);
    input.addEventListener("keydown", suggestionkeyDown);

    function triggerSuggestions () {
      const v = input.value;

      if (currentSuggestionRequest === v &amp;&amp; currentInput === input &amp;&amp; document.activeElement === input) {
        if (suggestions &amp;&amp; suggestions.children.length) {
          suggestions.hidden = false;
        }
        return;
      }

      currentInput = input;

      currentSuggestionRequest = v;

      if (input.value.length &lt; 3) {
        hideSuggestions();
        return;
      }

      const currentRequest = ++requestId;

      load(currentSuggestionRequest, function (results) {
        if (requestId !== currentRequest) {
          // another request is in flight
          return;
        }

        if (!results.length) {
          if (suggestions) {
            suggestions.textContent = "";
            hideSuggestions();
          }
          return;
        }

        if (!suggestions) {
          suggestions = document.createElement("ul");
          suggestions.className = "searchLocation-quickSearch-suggestions";
          document.body.appendChild(suggestions);
          fixPosition();
          window.addEventListener("scroll", fixPosition);
          window.addEventListener("resize", fixPosition);
          document.addEventListener("focusin", suggestionsFocusIn);
          input.addEventListener("focusin", triggerSuggestions);
          document.addEventListener("click", function (e) {
            if (e.target !== input) {
              hideSuggestions();
            }
          })
        }

        suggestions.hidden = false;
        fixPosition();
        suggestions.textContent = "";
        suggestions.append(
          ...results.map(r =&gt; {
            const li = document.createElement("li");
            const a = document.createElement("a");
            const title = document.createElement("p");
            const location = document.createElement("p");
            location.className = "searchLocation-quickSearch-suggestions-location";
            const icon = getSpanIcon(getKindIcon(r.kind));
            icon.title = r.kind;
            title.appendChild(icon);
            titleText = r.docTitle;
            if (r.kind.startsWith("attachment")) {
              icon.title = "attachment " + r.kind.substring(10).toLowerCase();
              titleText = r.attachmentFilename;
            } else if (r.kind === "comment") {
              const d = new Date(r.commentDate);
              titleText = d.toLocaleDateString() + " "  + d.toLocaleTimeString() + ", " + r.commentAuthor;
            }

            title.appendChild(document.createTextNode(" "));
            location.appendChild(getSpanIcon(fa("home")));
            location.appendChild(document.createTextNode(" / " + r.location.map(l =&gt; l.title).join(" / ")));
            a.appendChild(title);
            if (r.excerpt) {
              const excerpt = document.createElement("template");
              excerpt.innerHTML = r.excerpt;
              let excerptNode;
              if (excerpt.content.textContent.trim() === titleText.trim()) {
                excerptNode = document.createElement("span");
                title.appendChild(excerptNode);
              } else {
                excerptNode = document.createElement("p");
                a.appendChild(excerptNode);
                title.appendChild(document.createTextNode(titleText));
              }
              excerptNode.appendChild(excerpt.content);
              excerptNode.className = "searchLocation-quickSearch-suggestions-excerpt";
            } else {
              title.appendChild(document.createTextNode(titleText));
            }
            a.appendChild(location);
            a.href = r.url;
            a.addEventListener("keydown", suggestionkeyDown);
            li.appendChild(a);
            return li;
          })
        );
        suggestions.hidden = false;
      }, input);
    }
  }
});</code>
    </property>
    <property>
      <name>Location Search Suggest Results</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>c0adc480-96a5-476c-b3a8-34a214d47623</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <defaultValue>long</defaultValue>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <restricted>0</restricted>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>6</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>.searchLocation-quickSearch.box {
  margin: 0 1em 0 0;
  padding:0 1em 1em 1em;
  box-sizing:border-box;
  min-height:115px;
  min-width:265px
}
.searchLocation-quickSearch.box h3 {
  margin-top:1em
}
.searchLocation-quickSearch.float {
  float:left;
}
.searchLocation-quickSearch form {
  padding-bottom:.5em
}
.searchLocation-quickSearch p {
  margin:0;
  padding:0;
}
.searchLocation-quickSearch .input-group-btn .btn {
  margin-left: 5px
}

.searchLocation-quickSearch {
  margin: auto;
}

form.searchLocation .input-group-btn {
  display: flex;
  width: 100%;
  justify-content: center;
}

form.searchLocation .input-group-btn&gt;input[type="text"]:not(.fixed-width) {
  flex: 1;
  width: 100%;
}

.searchLocation-quickSearch-suggestions {
  margin: 0;
  margin-top: 2px;
  padding-top: 1ex;
  padding-bottom: 1ex;
  padding-left: 0;
  padding-right: 0;
  position: fixed;
  background: white;
  list-style: none;
  z-index: 100;
  border-radius: 4px;
  border: 1px solid rgba(0,0,0,.15);
  box-shadow: 0 6px 12px rgba(0,0,0,.175);
  overflow: auto;
}

.searchLocation-quickSearch-suggestions a {
  color: inherit;
  text-decoration: none;
  display: block;
  padding: 3px 20px;
}

.searchLocation-quickSearch-suggestions p {
  margin: 0;
  padding: 0;
}

.searchLocation-quickSearch-suggestions a:hover, .searchLocation-quickSearch-suggestions a:focus {
  color: #262626;
  background-color: #f5f5f5;
}

.searchLocation-quickSearch-suggestions-location, .searchLocation-quickSearch-suggestions-excerpt {
  color: #555555;
  font-size: smaller;
}

.searchLocation-quickSearch-suggestions-excerpt .search-text-highlight {
  background-color: #eee;
  font-weight: bold;
}</code>
    </property>
    <property>
      <contentType/>
    </property>
    <property>
      <name>Location Search Styles</name>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>54bb3f5a-055f-4d3e-83dc-333c9abe8b50</guid>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <async_cached>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>async_cached</name>
        <number>13</number>
        <prettyName>Cached</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </async_cached>
      <async_context>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>1</multiSelect>
        <name>async_context</name>
        <number>14</number>
        <prettyName>Context elements</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>, </separator>
        <separators>|, </separators>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <values>action=Action|doc.reference=Document|doc.revision|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.headers|request.parameters=Request parameters|request.remoteAddr|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </async_context>
      <async_enabled>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>async_enabled</name>
        <number>12</number>
        <prettyName>Asynchronous rendering</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </async_enabled>
      <code>
        <disabled>0</disabled>
        <editor>Text</editor>
        <name>code</name>
        <number>10</number>
        <prettyName>Macro code</prettyName>
        <restricted>0</restricted>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>contentDescription</name>
        <number>9</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentJavaType>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentJavaType</name>
        <number>8</number>
        <picker>1</picker>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentJavaType>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content availability</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategories>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>1</multiSelect>
        <name>defaultCategories</name>
        <number>4</number>
        <prettyName>Default categories</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values/>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </defaultCategories>
      <description>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <priority>
        <disabled>0</disabled>
        <name>priority</name>
        <number>11</number>
        <numberType>integer</numberType>
        <prettyName>Priority</prettyName>
        <size>10</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
      </priority>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <property>
      <async_cached>0</async_cached>
    </property>
    <property>
      <async_context>
        <value>doc.reference</value>
      </async_context>
    </property>
    <property>
      <async_enabled>0</async_enabled>
    </property>
    <property>
      <code>{{velocity}}
      #set ($title = "")
      #set ($references = $wikimacro.parameters.reference)
      #if ($references &amp;&amp; $!reference.isEmpty())
        #set ($searchLocationDocumentReference = $services.model.resolveDocument($references.get(0)))
        #if ($references.size() == 1)
          #set ($title = $xwiki.getDocument($searchLocationDocumentReference).displayTitle)
        #end
        #set ($wiki = $searchLocationDocumentReference.wikiReference.name)
      #else
        #set ($wiki = $xcontext.database)
      #end
      #set ($discard = $xwiki.ssx.use('LocationSearch.Code.LocationSearchMacro'))
      #set ($discard = $xwiki.jsx.use('LocationSearch.Code.LocationSearchMacro'))
      #set ($discard = $xwiki.linkx.use($services.webjars.url('selectize.js', 'css/selectize.bootstrap3.css'), {'type': 'text/css', 'rel': 'stylesheet'}))
      #set ($discard = $xwiki.ssfx.use('uicomponents/suggest/xwiki.selectize.css', true))
      #set ($boxLayout = "$!wikimacro.parameters.box")
      #if ("$!boxLayout" == '' || ("$!boxLayout" != 'true' &amp;&amp; "$!boxLayout" != 'false'))
        #set ($boxLayout = "false")
      #end
      #set ($floatLayout = "$!wikimacro.parameters.float")
      #if ("$!floatLayout" == '' || ("$!floatLayout" != 'true' &amp;&amp; "$!floatLayout" != 'false'))
        #set ($floatLayout = "false")
      #end
      #set ($placeholder = "$!wikimacro.parameters.placeholder")
      #if ("$!placeholder" == '')
        #set($placeholder = $services.localization.render('panels.search.inputText'))
      #end
      #set ($width = "$!wikimacro.parameters.width")
      #set ($inputWidth = "$!wikimacro.parameters.inputWidth")
      #set ($buttonWidth = "$!wikimacro.parameters.buttonWidth")
      #set ($description = "$!wikimacro.parameters.description")
      #set ($buttonText = "$!wikimacro.parameters.buttonText")
      #set ($showExcerpts = "$!wikimacro.parameters.showExcerpts")
      #set ($tags = "$!wikimacro.parameters.tags")
      #set ($tags = $tags.split(","))
      #set ($className = "$!wikimacro.parameters.className")
      ## $kind = title | content | comment | attachment | attachmentName | attachmentContent | object | all
      #set ($kind = "$!wikimacro.parameters.kind")
      #if ($kind == "")
        #set ($kind = "all")
      #end
      #set ($suggest = "$!wikimacro.parameters.suggest")
      #set ($suggest = $suggest != "0" &amp;&amp; $suggest.toLowerCase() != "false")

      (% class="searchLocation-quickSearch#if($boxLayout == 'true') box#end#if($floatLayout == 'true') float#end"
        #if($width != '') style="width:${escapetool.xml($width)}"#end
         data-search-kind="$escapetool.xml($kind)"
         data-suggest="$suggest"
         data-wiki="$escapetool.xml($wiki)"
         data-excerpts="#if($showExcerpts != "0" &amp;&amp; $showExcerpts != "false")true#{else}false#end"
      %)(((
        #if ($boxLayout == 'true')
          === #if ($services.icon)$services.icon.render('find')#end Search $title ===
        #end
        #if ("$!description" != '')
          $description
        #end
        (((
          {{html clean=false}}
            &lt;form class='searchLocation form-inline' action='${xwiki.getURL("$wiki:Main.Search")}' role='search'&gt;
              #if ($references &amp;&amp; !$references.isEmpty())
                #foreach ($reference in $references)
                  #set ($spaceReference = $NULL)
                  #if ($reference != "WebHome" &amp;&amp; !$reference.endsWith(".WebHome"))
                    #set ($spaceReference = $services.query.hql("select s from XWikiSpace s where s.reference = :ref").bindValue('ref', $reference).setWiki($wiki).execute()[0].getSpaceReference())
                  #end
                  #if (!$spaceReference)
                    #set ($d = $services.model.resolveDocument($reference))
                    #if ($d.getName() == "WebHome" || !$xwiki.getDocument($d).isNew())
                      #set ($spaceReference = $d.getParent())
                    #end
                  #end
                  #if (!$spaceReference)
                    #set ($spaceReference =  $services.model.resolveSpace($reference))
                  #end
                  #set ($spaceFacetDepth = $spaceReference.size() - 2)
                  #set ($spaceReferenceString = $services.model.serialize($spaceReference, "local"))
                  #if ($spaceReferenceString != "Main")
                    ## We exclude Main; Main.WebHome's (transitive) children is everybody
                    &lt;input type="hidden" name="f_space_facet" value="$spaceFacetDepth/${escapetool.xml($spaceReferenceString)}."/&gt;
                  #end
                #end
              #end
              #if ($className != "")
              &lt;input type="hidden" name="f_class" value="$escapetool.xml($className)"/&gt;
              #end
              #foreach ($tag in $tags)
              #if ("$tag" != "")
              &lt;input type="hidden" name="f_property.XWiki.TagClass.tags_string" value="$escapetool.xml($tag)"/&gt;
              #end
              #end
              &lt;input type="hidden" name="f_type" value="DOCUMENT"/&gt;
              ## The following line is a workaround for XWIKI-22102 and should be removed when the widespread versions of XWiki have a fix for this bug
              &lt;input type="hidden" name="r" value="1"/&gt;
              &lt;p&gt;
                &lt;span class='input-group-btn'&gt;
                  &lt;input type='text' name='text' placeholder="$!{escapetool.xml($placeholder)}" #if($inputWidth != '') class="fixed-width" style="width:${escapetool.xml($inputWidth)}"#end /&gt;
                  &lt;button type='submit' class='btn' title="$services.localization.render('search')" aria-expanded='false' aria-controls='searchLocationInput'#if($buttonWidth != '') style="width:${escapetool.xml($buttonWidth)}"#end&gt;#if($buttonText != '')${escapetool.xml($buttonText)}#else${services.localization.render('search')}#end&lt;/button&gt;
                &lt;/span&gt;
              &lt;/p&gt;
            &lt;/form&gt;
          {{/html}}
        )))
      ))) (%%)
{{/velocity}}</code>
    </property>
    <property>
      <contentDescription/>
    </property>
    <property>
      <contentJavaType/>
    </property>
    <property>
      <contentType>No content</contentType>
    </property>
    <property>
      <defaultCategories/>
    </property>
    <property>
      <description>Search in the given location.</description>
    </property>
    <property>
      <id>locationSearch</id>
    </property>
    <property>
      <name>Location Search</name>
    </property>
    <property>
      <priority/>
    </property>
    <property>
      <supportsInlineMode>1</supportsInlineMode>
    </property>
    <property>
      <visibility>Current Wiki</visibility>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>c26a8220-47b8-450b-a329-e253e7b9b66d</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>WebHome</defaultValue>
    </property>
    <property>
      <description>The reference(s) of the location(s) to search into. Use "WebHome" to search in children of the current document, "" to search everywhere. Use commas to specify several locations.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>reference</name>
    </property>
    <property>
      <type>java.util.List&lt;java.lang.String&gt;</type>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>1</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>6174fc7a-3145-429f-9f82-653d45a57ffe</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Display the search bar in a box.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>box</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>2</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>5675eae1-deb7-4f6d-99ad-43ec95eea260</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Adding float to the search block.</description>
    </property>
    <property>
      <mandatory/>
    </property>
    <property>
      <name>float</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>3</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>0f470d57-33dd-484f-b592-7fb3175fce75</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Text displayed on the button.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>buttonText</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>4</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>6bb7ff5f-4e21-474d-b3eb-8468dfbc870a</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The search should be restricted to documents containing on of these tags, separated with a pipe character (|).</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>tags</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>5</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>9e4bc443-cac6-47a0-a458-96aa52374bac</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The search should be restricted to documents with objects of this type</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>className</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>6</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>ce808b98-d890-4a32-8ec2-b986f1d9fb52</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>all</defaultValue>
    </property>
    <property>
      <description>The search should be restricted to this kind of elements (possible values: title, content, comment, attachment, attachmentName, attachmentContent, object, all; default: all)</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>kind</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>7</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>2a29a303-c486-4bbb-8f95-987b9a100907</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>1</defaultValue>
    </property>
    <property>
      <description>Suggest results as the search is typed</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>suggest</name>
    </property>
    <property>
      <type>java.lang.Boolean</type>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>8</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>5b4bf267-e728-45bf-b976-538208a8c694</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>1</defaultValue>
    </property>
    <property>
      <description>Show exceprts with highlighted matches in suggested results</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>showExcerpts</name>
    </property>
    <property>
      <type>java.lang.Boolean</type>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>9</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>1b765c7a-ce45-4c9a-8cde-1f867bd77973</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Width of the search box</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>width</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>10</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>79c4272d-42e1-402a-bd32-9c6f3563946d</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Size of the search input</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>inputWidth</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>11</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>fab4d816-b6d0-43b7-9f5b-71776da77718</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Search of the search button</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>buttonWidth</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
  <object>
    <name>LocationSearch.Code.LocationSearchMacro</name>
    <number>12</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>c0ef74bd-9c94-4ac4-8fe6-4884d3e707be</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <restricted>0</restricted>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>type</name>
        <number>5</number>
        <picker>1</picker>
        <prettyName>Parameter type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Description of the search box</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>description</name>
    </property>
    <property>
      <type/>
    </property>
  </object>
</xwikidoc>
